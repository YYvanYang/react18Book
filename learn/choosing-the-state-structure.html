<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Choosing the State Structure - React 18 Docs</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">Get Started</li><li class="chapter-item expanded "><a href="../learn/index.html"><strong aria-hidden="true">1.</strong> Quick Start</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../learn/tutorial-tic-tac-toe.html"><strong aria-hidden="true">1.1.</strong> Tutorial: Tic-Tac-Toe</a></li><li class="chapter-item expanded "><a href="../learn/thinking-in-react.html"><strong aria-hidden="true">1.2.</strong> Thinking in React</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Learn React</li><li class="chapter-item expanded "><a href="../learn/describing-the-ui.html"><strong aria-hidden="true">2.</strong> Describing the UI</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../learn/your-first-component.html"><strong aria-hidden="true">2.1.</strong> Your First Component</a></li><li class="chapter-item expanded "><a href="../learn/importing-and-exporting-components.html"><strong aria-hidden="true">2.2.</strong> Importing and Exporting Components</a></li><li class="chapter-item expanded "><a href="../learn/writing-markup-with-jsx.html"><strong aria-hidden="true">2.3.</strong> WritiPng Markup with JSX</a></li><li class="chapter-item expanded "><a href="../learn/javascript-in-jsx-with-curly-braces.html"><strong aria-hidden="true">2.4.</strong> JavaScript in JSX with Curly Braces</a></li><li class="chapter-item expanded "><a href="../learn/passing-props-to-a-component.html"><strong aria-hidden="true">2.5.</strong> Passing Props to a Component</a></li><li class="chapter-item expanded "><a href="../learn/conditional-rendering.html"><strong aria-hidden="true">2.6.</strong> Conditional Rendering</a></li><li class="chapter-item expanded "><a href="../learn/rendering-lists.html"><strong aria-hidden="true">2.7.</strong> Rendering Lists</a></li><li class="chapter-item expanded "><a href="../learn/keeping-components-pure.html"><strong aria-hidden="true">2.8.</strong> Keeping Components Pure</a></li></ol></li><li class="chapter-item expanded "><a href="../learn/adding-interactivity.html"><strong aria-hidden="true">3.</strong> Adding Interactivity</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../learn/responding-to-events.html"><strong aria-hidden="true">3.1.</strong> Responding to Events</a></li><li class="chapter-item expanded "><a href="../learn/state-a-components-memory.html"><strong aria-hidden="true">3.2.</strong> State: A Component's Memory</a></li><li class="chapter-item expanded "><a href="../learn/render-and-commit.html"><strong aria-hidden="true">3.3.</strong> Render and Commit</a></li><li class="chapter-item expanded "><a href="../learn/state-as-a-snapshot.html"><strong aria-hidden="true">3.4.</strong> State as a Snapshot</a></li><li class="chapter-item expanded "><a href="../learn/queueing-a-series-of-state-updates.html"><strong aria-hidden="true">3.5.</strong> Queueing a Series of State Updates</a></li><li class="chapter-item expanded "><a href="../learn/updating-objects-in-state.html"><strong aria-hidden="true">3.6.</strong> Updating Objects in State</a></li><li class="chapter-item expanded "><a href="../learn/updating-arrays-in-state.html"><strong aria-hidden="true">3.7.</strong> Updating Arrays in State</a></li></ol></li><li class="chapter-item expanded "><a href="../learn/managing-state.html"><strong aria-hidden="true">4.</strong> Managing State</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../learn/reacting-to-input-with-state.html"><strong aria-hidden="true">4.1.</strong> Reacting to Input with State</a></li><li class="chapter-item expanded "><a href="../learn/choosing-the-state-structure.html" class="active"><strong aria-hidden="true">4.2.</strong> Choosing the State Structure</a></li><li class="chapter-item expanded "><a href="../learn/sharing-state-between-components.html"><strong aria-hidden="true">4.3.</strong> Sharing State Between Components</a></li><li class="chapter-item expanded "><a href="../learn/preserving-and-resetting-state.html"><strong aria-hidden="true">4.4.</strong> Preserving and Resetting State</a></li><li class="chapter-item expanded "><a href="../learn/extracting-state-logic-into-a-reducer.html"><strong aria-hidden="true">4.5.</strong> Extracting State Logic into a Reducer</a></li><li class="chapter-item expanded "><a href="../learn/passing-data-deeply-with-context.html"><strong aria-hidden="true">4.6.</strong> Passing Data Deeply with Context</a></li><li class="chapter-item expanded "><a href="../learn/scaling-up-with-reducer-and-context.html"><strong aria-hidden="true">4.7.</strong> Scaling Up with Reducer and Context</a></li></ol></li><li class="chapter-item expanded "><a href="../learn/escape-hatches.html"><strong aria-hidden="true">5.</strong> Escape Hatches</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../learn/referencing-values-with-refs.html"><strong aria-hidden="true">5.1.</strong> Referencing Values with Refs</a></li><li class="chapter-item expanded "><a href="../learn/manipulating-the-dom-with-refs.html"><strong aria-hidden="true">5.2.</strong> Manipulating the DOM with Refs</a></li><li class="chapter-item expanded "><a href="../learn/synchronizing-with-effects.html"><strong aria-hidden="true">5.3.</strong> Synchronizing with Effects</a></li><li class="chapter-item expanded "><a href="../learn/you-might-not-need-an-effect.html"><strong aria-hidden="true">5.4.</strong> You Might Not Need an Effect</a></li><li class="chapter-item expanded "><a href="../learn/lifecycle-of-reactive-effects.html"><strong aria-hidden="true">5.5.</strong> Lifecycle of Reactive Effects</a></li><li class="chapter-item expanded "><a href="../learn/separating-events-from-effects.html"><strong aria-hidden="true">5.6.</strong> Separating Events from Effects</a></li><li class="chapter-item expanded "><a href="../learn/removing-effect-dependencies.html"><strong aria-hidden="true">5.7.</strong> Removing Effect Dependencies</a></li><li class="chapter-item expanded "><a href="../learn/reusing-logic-with-custom-hooks.html"><strong aria-hidden="true">5.8.</strong> Reusing Logic with Custom Hooks</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Reference</li><li class="chapter-item expanded affix "><li class="part-title">'react' package</li><li class="chapter-item expanded "><a href="../reference/react/components.html"><strong aria-hidden="true">6.</strong> Components</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/react/Fragment.html"><strong aria-hidden="true">6.1.</strong> &lt;Fragment&gt; (&lt;&gt;...&lt;/&gt;)</a></li><li class="chapter-item expanded "><a href="../reference/react/Profiler.html"><strong aria-hidden="true">6.2.</strong> &lt;Profiler&gt;</a></li><li class="chapter-item expanded "><a href="../reference/react/StrictMode.html"><strong aria-hidden="true">6.3.</strong> &lt;StrictMode&gt;</a></li><li class="chapter-item expanded "><a href="../reference/react/Suspense.html"><strong aria-hidden="true">6.4.</strong> &lt;Suspense&gt;</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/react/index.html"><strong aria-hidden="true">7.</strong> Hooks</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/react/useCallback.html"><strong aria-hidden="true">7.1.</strong> useCallback</a></li><li class="chapter-item expanded "><a href="../reference/react/useContext.html"><strong aria-hidden="true">7.2.</strong> useContext</a></li><li class="chapter-item expanded "><a href="../reference/react/useDebugValue.html"><strong aria-hidden="true">7.3.</strong> useDebugValue</a></li><li class="chapter-item expanded "><a href="../reference/react/useDeferredValue.html"><strong aria-hidden="true">7.4.</strong> useDeferredValue</a></li><li class="chapter-item expanded "><a href="../reference/react/useEffect.html"><strong aria-hidden="true">7.5.</strong> useEffect</a></li><li class="chapter-item expanded "><a href="../reference/react/useId.html"><strong aria-hidden="true">7.6.</strong> useId</a></li><li class="chapter-item expanded "><a href="../reference/react/useImperativeHandle.html"><strong aria-hidden="true">7.7.</strong> useImperativeHandle</a></li><li class="chapter-item expanded "><a href="../reference/react/useInsertionEffect.html"><strong aria-hidden="true">7.8.</strong> useInsertionEffect</a></li><li class="chapter-item expanded "><a href="../reference/react/useLayoutEffect.html"><strong aria-hidden="true">7.9.</strong> useLayoutEffect</a></li><li class="chapter-item expanded "><a href="../reference/react/useMemo.html"><strong aria-hidden="true">7.10.</strong> useMemo</a></li><li class="chapter-item expanded "><a href="../reference/react/useReducer.html"><strong aria-hidden="true">7.11.</strong> useReducer</a></li><li class="chapter-item expanded "><a href="../reference/react/useRef.html"><strong aria-hidden="true">7.12.</strong> useRef</a></li><li class="chapter-item expanded "><a href="../reference/react/useState.html"><strong aria-hidden="true">7.13.</strong> useState</a></li><li class="chapter-item expanded "><a href="../reference/react/useSyncExternalStore.html"><strong aria-hidden="true">7.14.</strong> useSyncExternalStore</a></li><li class="chapter-item expanded "><a href="../reference/react/useTransition.html"><strong aria-hidden="true">7.15.</strong> useTransition</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/react/apis.html"><strong aria-hidden="true">8.</strong> APIs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/react/createContext.html"><strong aria-hidden="true">8.1.</strong> createContext</a></li><li class="chapter-item expanded "><a href="../reference/react/forwardRef.html"><strong aria-hidden="true">8.2.</strong> forwardRef</a></li><li class="chapter-item expanded "><a href="../reference/react/lazy.html"><strong aria-hidden="true">8.3.</strong> lazy</a></li><li class="chapter-item expanded "><a href="../reference/react/memo.html"><strong aria-hidden="true">8.4.</strong> memo</a></li><li class="chapter-item expanded "><a href="../reference/react/startTransition.html"><strong aria-hidden="true">8.5.</strong> startTransition</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">'react-dom' package</li><li class="chapter-item expanded "><a href="../reference/react-dom/components/index.html"><strong aria-hidden="true">9.</strong> Components</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/react-dom/components/common.html"><strong aria-hidden="true">9.1.</strong> Common components (e.g. &lt;div&gt;)</a></li><li class="chapter-item expanded "><a href="../reference/react-dom/components/input.html"><strong aria-hidden="true">9.2.</strong> &lt;input&gt;</a></li><li class="chapter-item expanded "><a href="../reference/react-dom/components/option.html"><strong aria-hidden="true">9.3.</strong> &lt;option&gt;</a></li><li class="chapter-item expanded "><a href="../reference/react-dom/components/progress.html"><strong aria-hidden="true">9.4.</strong> &lt;progress&gt;</a></li><li class="chapter-item expanded "><a href="../reference/react-dom/components/select.html"><strong aria-hidden="true">9.5.</strong> &lt;select&gt;</a></li><li class="chapter-item expanded "><a href="../reference/react-dom/components/textarea.html"><strong aria-hidden="true">9.6.</strong> &lt;textarea&gt;</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/react-dom/index.html"><strong aria-hidden="true">10.</strong> APIs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/react-dom/createPortal.html"><strong aria-hidden="true">10.1.</strong> createPortal</a></li><li class="chapter-item expanded "><a href="../reference/react-dom/flushSync.html"><strong aria-hidden="true">10.2.</strong> flushSync</a></li><li class="chapter-item expanded "><a href="../reference/react-dom/findDOMNode.html"><strong aria-hidden="true">10.3.</strong> findDOMNode</a></li><li class="chapter-item expanded "><a href="../reference/react-dom/hydrate.html"><strong aria-hidden="true">10.4.</strong> hydrate</a></li><li class="chapter-item expanded "><a href="../reference/react-dom/render.html"><strong aria-hidden="true">10.5.</strong> render</a></li><li class="chapter-item expanded "><a href="../reference/react-dom/unmountComponentAtNode.html"><strong aria-hidden="true">10.6.</strong> unmountComponentAtNode</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/react-dom/client/index.html"><strong aria-hidden="true">11.</strong> Client APIs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/react-dom/client/createRoot.html"><strong aria-hidden="true">11.1.</strong> createRoot</a></li><li class="chapter-item expanded "><a href="../reference/react-dom/client/hydrateRoot.html"><strong aria-hidden="true">11.2.</strong> hydrateRoot</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/react-dom/server/index.html"><strong aria-hidden="true">12.</strong> Server APIs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/react-dom/server/renderToNodeStream.html"><strong aria-hidden="true">12.1.</strong> renderToNodeStream</a></li><li class="chapter-item expanded "><a href="../reference/react-dom/server/renderToPipeableStream.html"><strong aria-hidden="true">12.2.</strong> renderToPipeableStream</a></li><li class="chapter-item expanded "><a href="../reference/react-dom/server/renderToReadableStream.html"><strong aria-hidden="true">12.3.</strong> renderToReadableStream</a></li><li class="chapter-item expanded "><a href="../reference/react-dom/server/renderToStaticMarkup.html"><strong aria-hidden="true">12.4.</strong> renderToStaticMarkup</a></li><li class="chapter-item expanded "><a href="../reference/react-dom/server/renderToStaticNodeStream.html"><strong aria-hidden="true">12.5.</strong> renderToStaticNodeStream</a></li><li class="chapter-item expanded "><a href="../reference/react-dom/server/renderToString.html"><strong aria-hidden="true">12.6.</strong> renderToString</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Legacy APIs</li><li class="chapter-item expanded "><a href="../reference/react/legacy.html"><strong aria-hidden="true">13.</strong> Legacy React APIs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/react/Children.html"><strong aria-hidden="true">13.1.</strong> Children</a></li><li class="chapter-item expanded "><a href="../reference/react/cloneElement.html"><strong aria-hidden="true">13.2.</strong> cloneElement</a></li><li class="chapter-item expanded "><a href="../reference/react/Component.html"><strong aria-hidden="true">13.3.</strong> Component</a></li><li class="chapter-item expanded "><a href="../reference/react/createElement.html"><strong aria-hidden="true">13.4.</strong> createElement</a></li><li class="chapter-item expanded "><a href="../reference/react/createFactory.html"><strong aria-hidden="true">13.5.</strong> createFactory</a></li><li class="chapter-item expanded "><a href="../reference/react/createRef.html"><strong aria-hidden="true">13.6.</strong> createRef</a></li><li class="chapter-item expanded "><a href="../reference/react/isValidElement.html"><strong aria-hidden="true">13.7.</strong> isValidElement</a></li><li class="chapter-item expanded "><a href="../reference/react/PureComponent.html"><strong aria-hidden="true">13.8.</strong> PureComponent</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">React 18 Docs</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <hr />
<h2 id="title-choosing-the-state-structure"><a class="header" href="#title-choosing-the-state-structure">title: Choosing the State Structure</a></h2>
<Intro>
<p>Structuring state well can make a difference between a component that is pleasant to modify and debug, and one that is a constant source of bugs. Here are some tips you should consider when structuring state.</p>
</Intro>
<YouWillLearn>
<ul>
<li>When to use a single vs multiple state variables</li>
<li>What to avoid when organizing state</li>
<li>How to fix common issues with the state structure</li>
</ul>
</YouWillLearn>
<h2 id="principles-for-structuring-state-principles-for-structuring-state"><a class="header" href="#principles-for-structuring-state-principles-for-structuring-state">Principles for structuring state {/<em>principles-for-structuring-state</em>/}</a></h2>
<p>When you write a component that holds some state, you'll have to make choices about how many state variables to use and what the shape of their data should be. While it's possible to write correct programs even with a suboptimal state structure, there are a few principles that can guide you to make better choices:</p>
<ol>
<li><strong>Group related state.</strong> If you always update two or more state variables at the same time, consider merging them into a single state variable.</li>
<li><strong>Avoid contradictions in state.</strong> When the state is structured in a way that several pieces of state may contradict and &quot;disagree&quot; with each other, you leave room for mistakes. Try to avoid this.</li>
<li><strong>Avoid redundant state.</strong> If you can calculate some information from the component's props or its existing state variables during rendering, you should not put that information into that component's state.</li>
<li><strong>Avoid duplication in state.</strong> When the same data is duplicated between multiple state variables, or within nested objects, it is difficult to keep them in sync. Reduce duplication when you can.</li>
<li><strong>Avoid deeply nested state.</strong> Deeply hierarchical state is not very convenient to update. When possible, prefer to structure state in a flat way.</li>
</ol>
<p>The goal behind these principles is to <em>make state easy to update without introducing mistakes</em>. Removing redundant and duplicate data from state helps ensure that all its pieces stay in sync. This is similar to how a database engineer might want to <a href="https://docs.microsoft.com/en-us/office/troubleshoot/access/database-normalization-description">&quot;normalize&quot; the database structure</a> to reduce the chance of bugs. To paraphrase Albert Einstein, <strong>&quot;Make your state as simple as it can be--but no simpler.&quot;</strong></p>
<p>Now let's see how these principles apply in action.</p>
<h2 id="group-related-state-group-related-state"><a class="header" href="#group-related-state-group-related-state">Group related state {/<em>group-related-state</em>/}</a></h2>
<p>You might sometimes be unsure between using a single or multiple state variables.</p>
<p>Should you do this?</p>
<pre><code class="language-js">const [x, setX] = useState(0);
const [y, setY] = useState(0);
</code></pre>
<p>Or this?</p>
<pre><code class="language-js">const [position, setPosition] = useState({ x: 0, y: 0 });
</code></pre>
<p>Technically, you can use either of these approaches. But <strong>if some two state variables always change together, it might be a good idea to unify them into a single state variable.</strong> Then you won't forget to always keep them in sync, like in this example where moving the cursor updates both coordinates of the red dot:</p>
<Sandpack>
<pre><code class="language-js">import { useState } from 'react';

export default function MovingDot() {
  const [position, setPosition] = useState({
    x: 0,
    y: 0
  });
  return (
    &lt;div
      onPointerMove={e =&gt; {
        setPosition({
          x: e.clientX,
          y: e.clientY
        });
      }}
      style={{
        position: 'relative',
        width: '100vw',
        height: '100vh',
      }}&gt;
      &lt;div style={{
        position: 'absolute',
        backgroundColor: 'red',
        borderRadius: '50%',
        transform: `translate(${position.x}px, ${position.y}px)`,
        left: -10,
        top: -10,
        width: 20,
        height: 20,
      }} /&gt;
    &lt;/div&gt;
  )
}
</code></pre>
<pre><code class="language-css">body { margin: 0; padding: 0; height: 250px; }
</code></pre>
</Sandpack>
<p>Another case where you'll group data into an object or an array is when you don't know how many different pieces of state you'll need. For example, it's helpful when you have a form where the user can add custom fields.</p>
<Pitfall>
<p>If your state variable is an object, remember that <a href="/learn/updating-objects-in-state">you can't update only one field in it</a> without explicitly copying the other fields. For example, you can't do <code>setPosition({ x: 100 })</code> in the above example because it would not have the <code>y</code> property at all! Instead, if you wanted to set <code>x</code> alone, you would either do <code>setPosition({ ...position, x: 100 })</code>, or split them into two state variables and do <code>setX(100)</code>.</p>
</Pitfall>
<h2 id="avoid-contradictions-in-state-avoid-contradictions-in-state"><a class="header" href="#avoid-contradictions-in-state-avoid-contradictions-in-state">Avoid contradictions in state {/<em>avoid-contradictions-in-state</em>/}</a></h2>
<p>Here is a hotel feedback form with <code>isSending</code> and <code>isSent</code> state variables:</p>
<Sandpack>
<pre><code class="language-js">import { useState } from 'react';

export default function FeedbackForm() {
  const [text, setText] = useState('');
  const [isSending, setIsSending] = useState(false);
  const [isSent, setIsSent] = useState(false);

  async function handleSubmit(e) {
    e.preventDefault();
    setIsSending(true);
    await sendMessage(text);
    setIsSending(false);
    setIsSent(true);
  }

  if (isSent) {
    return &lt;h1&gt;Thanks for feedback!&lt;/h1&gt;
  }

  return (
    &lt;form onSubmit={handleSubmit}&gt;
      &lt;p&gt;How was your stay at The Prancing Pony?&lt;/p&gt;
      &lt;textarea
        disabled={isSending}
        value={text}
        onChange={e =&gt; setText(e.target.value)}
      /&gt;
      &lt;br /&gt;
      &lt;button
        disabled={isSending}
        type=&quot;submit&quot;
      &gt;
        Send
      &lt;/button&gt;
      {isSending &amp;&amp; &lt;p&gt;Sending...&lt;/p&gt;}
    &lt;/form&gt;
  );
}

// Pretend to send a message.
function sendMessage(text) {
  return new Promise(resolve =&gt; {
    setTimeout(resolve, 2000);
  });
}
</code></pre>
</Sandpack>
<p>While this code works, it leaves the door open for &quot;impossible&quot; states. For example, if you forget to call <code>setIsSent</code> and <code>setIsSending</code> together, you may end up in a situation where both <code>isSending</code> and <code>isSent</code> are <code>true</code> at the same time. The more complex your component is, the harder it will be to understand what happened.</p>
<p><strong>Since <code>isSending</code> and <code>isSent</code> should never be <code>true</code> at the same time, it is better to replace them with one <code>status</code> state variable that may take one of <em>three</em> valid states:</strong> <code>'typing'</code> (initial), <code>'sending'</code>, and <code>'sent'</code>:</p>
<Sandpack>
<pre><code class="language-js">import { useState } from 'react';

export default function FeedbackForm() {
  const [text, setText] = useState('');
  const [status, setStatus] = useState('typing');

  async function handleSubmit(e) {
    e.preventDefault();
    setStatus('sending');
    await sendMessage(text);
    setStatus('sent');
  }

  const isSending = status === 'sending';
  const isSent = status === 'sent';

  if (isSent) {
    return &lt;h1&gt;Thanks for feedback!&lt;/h1&gt;
  }

  return (
    &lt;form onSubmit={handleSubmit}&gt;
      &lt;p&gt;How was your stay at The Prancing Pony?&lt;/p&gt;
      &lt;textarea
        disabled={isSending}
        value={text}
        onChange={e =&gt; setText(e.target.value)}
      /&gt;
      &lt;br /&gt;
      &lt;button
        disabled={isSending}
        type=&quot;submit&quot;
      &gt;
        Send
      &lt;/button&gt;
      {isSending &amp;&amp; &lt;p&gt;Sending...&lt;/p&gt;}
    &lt;/form&gt;
  );
}

// Pretend to send a message.
function sendMessage(text) {
  return new Promise(resolve =&gt; {
    setTimeout(resolve, 2000);
  });
}
</code></pre>
</Sandpack>
<p>You can still declare some constants for readability:</p>
<pre><code class="language-js">const isSending = status === 'sending';
const isSent = status === 'sent';
</code></pre>
<p>But they're not state variables, so you don't need to worry about them getting out of sync with each other.</p>
<h2 id="avoid-redundant-state-avoid-redundant-state"><a class="header" href="#avoid-redundant-state-avoid-redundant-state">Avoid redundant state {/<em>avoid-redundant-state</em>/}</a></h2>
<p>If you can calculate some information from the component's props or its existing state variables during rendering, you <strong>should not</strong> put that information into that component's state.</p>
<p>For example, take this form. It works, but can you find any redundant state in it?</p>
<Sandpack>
<pre><code class="language-js">import { useState } from 'react';

export default function Form() {
  const [firstName, setFirstName] = useState('');
  const [lastName, setLastName] = useState('');
  const [fullName, setFullName] = useState('');

  function handleFirstNameChange(e) {
    setFirstName(e.target.value);
    setFullName(e.target.value + ' ' + lastName);
  }

  function handleLastNameChange(e) {
    setLastName(e.target.value);
    setFullName(firstName + ' ' + e.target.value);
  }

  return (
    &lt;&gt;
      &lt;h2&gt;Let’s check you in&lt;/h2&gt;
      &lt;label&gt;
        First name:{' '}
        &lt;input
          value={firstName}
          onChange={handleFirstNameChange}
        /&gt;
      &lt;/label&gt;
      &lt;label&gt;
        Last name:{' '}
        &lt;input
          value={lastName}
          onChange={handleLastNameChange}
        /&gt;
      &lt;/label&gt;
      &lt;p&gt;
        Your ticket will be issued to: &lt;b&gt;{fullName}&lt;/b&gt;
      &lt;/p&gt;
    &lt;/&gt;
  );
}
</code></pre>
<pre><code class="language-css">label { display: block; margin-bottom: 5px; }
</code></pre>
</Sandpack>
<p>This form has three state variables: <code>firstName</code>, <code>lastName</code>, and <code>fullName</code>. However, <code>fullName</code> is redundant. <strong>You can always calculate <code>fullName</code> from <code>firstName</code> and <code>lastName</code> during render, so remove it from state.</strong></p>
<p>This is how you can do it:</p>
<Sandpack>
<pre><code class="language-js">import { useState } from 'react';

export default function Form() {
  const [firstName, setFirstName] = useState('');
  const [lastName, setLastName] = useState('');

  const fullName = firstName + ' ' + lastName;

  function handleFirstNameChange(e) {
    setFirstName(e.target.value);
  }

  function handleLastNameChange(e) {
    setLastName(e.target.value);
  }

  return (
    &lt;&gt;
      &lt;h2&gt;Let’s check you in&lt;/h2&gt;
      &lt;label&gt;
        First name:{' '}
        &lt;input
          value={firstName}
          onChange={handleFirstNameChange}
        /&gt;
      &lt;/label&gt;
      &lt;label&gt;
        Last name:{' '}
        &lt;input
          value={lastName}
          onChange={handleLastNameChange}
        /&gt;
      &lt;/label&gt;
      &lt;p&gt;
        Your ticket will be issued to: &lt;b&gt;{fullName}&lt;/b&gt;
      &lt;/p&gt;
    &lt;/&gt;
  );
}
</code></pre>
<pre><code class="language-css">label { display: block; margin-bottom: 5px; }
</code></pre>
</Sandpack>
<p>Here, <code>fullName</code> is <em>not</em> a state variable. Instead, it's calculated during render:</p>
<pre><code class="language-js">const fullName = firstName + ' ' + lastName;
</code></pre>
<p>As a result, the change handlers don't need to do anything special to update it. When you call <code>setFirstName</code> or <code>setLastName</code>, you trigger a re-render, and then the next <code>fullName</code> will be calculated from the fresh data.</p>
<DeepDive>
<h4 id="dont-mirror-props-in-state-don-t-mirror-props-in-state"><a class="header" href="#dont-mirror-props-in-state-don-t-mirror-props-in-state">Don't mirror props in state {/<em>don-t-mirror-props-in-state</em>/}</a></h4>
<p>A common example of redundant state is code like this:</p>
<pre><code class="language-js">function Message({ messageColor }) {
  const [color, setColor] = useState(messageColor);
</code></pre>
<p>Here, a <code>color</code> state variable is initialized to the <code>messageColor</code> prop. The problem is that <strong>if the parent component passes a different value of <code>messageColor</code> later (for example, <code>'red'</code> instead of <code>'blue'</code>), the <code>color</code> <em>state variable</em> would not be updated!</strong> The state is only initialized during the first render.</p>
<p>This is why &quot;mirroring&quot; some prop in a state variable can lead to confusion. Instead, use the <code>messageColor</code> prop directly in your code. If you want to give it a shorter name, use a constant:</p>
<pre><code class="language-js">function Message({ messageColor }) {
  const color = messageColor;
</code></pre>
<p>This way it won't get out of sync with the prop passed from the parent component.</p>
<p>&quot;Mirroring&quot; props into state only makes sense when you <em>want</em> to ignore all updates for a specific prop. By convention, start the prop name with <code>initial</code> or <code>default</code> to clarify that its new values are ignored:</p>
<pre><code class="language-js">function Message({ initialColor }) {
  // The `color` state variable holds the *first* value of `initialColor`.
  // Further changes to the `initialColor` prop are ignored.
  const [color, setColor] = useState(initialColor);
</code></pre>
</DeepDive>
<h2 id="avoid-duplication-in-state-avoid-duplication-in-state"><a class="header" href="#avoid-duplication-in-state-avoid-duplication-in-state">Avoid duplication in state {/<em>avoid-duplication-in-state</em>/}</a></h2>
<p>This menu list component lets you choose a single travel snack out of several:</p>
<Sandpack>
<pre><code class="language-js">import { useState } from 'react';

const initialItems = [
  { title: 'pretzels', id: 0 },
  { title: 'crispy seaweed', id: 1 },
  { title: 'granola bar', id: 2 },
];

export default function Menu() {
  const [items, setItems] = useState(initialItems);
  const [selectedItem, setSelectedItem] = useState(
    items[0]
  );

  return (
    &lt;&gt;
      &lt;h2&gt;What's your travel snack?&lt;/h2&gt;
      &lt;ul&gt;
        {items.map(item =&gt; (
          &lt;li key={item.id}&gt;
            {item.title}
            {' '}
            &lt;button onClick={() =&gt; {
              setSelectedItem(item);
            }}&gt;Choose&lt;/button&gt;
          &lt;/li&gt;
        ))}
      &lt;/ul&gt;
      &lt;p&gt;You picked {selectedItem.title}.&lt;/p&gt;
    &lt;/&gt;
  );
}
</code></pre>
<pre><code class="language-css">button { margin-top: 10px; }
</code></pre>
</Sandpack>
<p>Currently, it stores the selected item as an object in the <code>selectedItem</code> state variable. However, this is not great: <strong>the contents of the <code>selectedItem</code> is the same object as one of the items inside the <code>items</code> list.</strong> This means that the information about the item itself is duplicated in two places.</p>
<p>Why is this a problem? Let's make each item editable:</p>
<Sandpack>
<pre><code class="language-js">import { useState } from 'react';

const initialItems = [
  { title: 'pretzels', id: 0 },
  { title: 'crispy seaweed', id: 1 },
  { title: 'granola bar', id: 2 },
];

export default function Menu() {
  const [items, setItems] = useState(initialItems);
  const [selectedItem, setSelectedItem] = useState(
    items[0]
  );

  function handleItemChange(id, e) {
    setItems(items.map(item =&gt; {
      if (item.id === id) {
        return {
          ...item,
          title: e.target.value,
        };
      } else {
        return item;
      }
    }));
  }

  return (
    &lt;&gt;
      &lt;h2&gt;What's your travel snack?&lt;/h2&gt; 
      &lt;ul&gt;
        {items.map((item, index) =&gt; (
          &lt;li key={item.id}&gt;
            &lt;input
              value={item.title}
              onChange={e =&gt; {
                handleItemChange(item.id, e)
              }}
            /&gt;
            {' '}
            &lt;button onClick={() =&gt; {
              setSelectedItem(item);
            }}&gt;Choose&lt;/button&gt;
          &lt;/li&gt;
        ))}
      &lt;/ul&gt;
      &lt;p&gt;You picked {selectedItem.title}.&lt;/p&gt;
    &lt;/&gt;
  );
}
</code></pre>
<pre><code class="language-css">button { margin-top: 10px; }
</code></pre>
</Sandpack>
<p>Notice how if you first click &quot;Choose&quot; on an item and <em>then</em> edit it, <strong>the input updates but the label at the bottom does not reflect the edits.</strong> This is because you have duplicated state, and you forgot to update <code>selectedItem</code>.</p>
<p>Although you could update <code>selectedItem</code> too, an easier fix is to remove duplication. In this example, instead of a <code>selectedItem</code> object (which creates a duplication with objects inside <code>items</code>), you hold the <code>selectedId</code> in state, and <em>then</em> get the <code>selectedItem</code> by searching the <code>items</code> array for an item with that ID:</p>
<Sandpack>
<pre><code class="language-js">import { useState } from 'react';

const initialItems = [
  { title: 'pretzels', id: 0 },
  { title: 'crispy seaweed', id: 1 },
  { title: 'granola bar', id: 2 },
];

export default function Menu() {
  const [items, setItems] = useState(initialItems);
  const [selectedId, setSelectedId] = useState(0);

  const selectedItem = items.find(item =&gt;
    item.id === selectedId
  );

  function handleItemChange(id, e) {
    setItems(items.map(item =&gt; {
      if (item.id === id) {
        return {
          ...item,
          title: e.target.value,
        };
      } else {
        return item;
      }
    }));
  }

  return (
    &lt;&gt;
      &lt;h2&gt;What's your travel snack?&lt;/h2&gt;
      &lt;ul&gt;
        {items.map((item, index) =&gt; (
          &lt;li key={item.id}&gt;
            &lt;input
              value={item.title}
              onChange={e =&gt; {
                handleItemChange(item.id, e)
              }}
            /&gt;
            {' '}
            &lt;button onClick={() =&gt; {
              setSelectedId(item.id);
            }}&gt;Choose&lt;/button&gt;
          &lt;/li&gt;
        ))}
      &lt;/ul&gt;
      &lt;p&gt;You picked {selectedItem.title}.&lt;/p&gt;
    &lt;/&gt;
  );
}
</code></pre>
<pre><code class="language-css">button { margin-top: 10px; }
</code></pre>
</Sandpack>
<p>(Alternatively, you may hold the selected index in state.)</p>
<p>The state used to be duplicated like this:</p>
<ul>
<li><code>items = [{ id: 0, title: 'pretzels'}, ...]</code></li>
<li><code>selectedItem = {id: 0, title: 'pretzels'}</code></li>
</ul>
<p>But after the change it's like this:</p>
<ul>
<li><code>items = [{ id: 0, title: 'pretzels'}, ...]</code></li>
<li><code>selectedId = 0</code></li>
</ul>
<p>The duplication is gone, and you only keep the essential state!</p>
<p>Now if you edit the <em>selected</em> item, the message below will update immediately. This is because <code>setItems</code> triggers a re-render, and <code>items.find(...)</code> would find the item with the updated title. You didn't need to hold <em>the selected item</em> in state, because only the <em>selected ID</em> is essential. The rest could be calculated during render.</p>
<h2 id="avoid-deeply-nested-state-avoid-deeply-nested-state"><a class="header" href="#avoid-deeply-nested-state-avoid-deeply-nested-state">Avoid deeply nested state {/<em>avoid-deeply-nested-state</em>/}</a></h2>
<p>Imagine a travel plan consisting of planets, continents, and countries. You might be tempted to structure its state using nested objects and arrays, like in this example:</p>
<Sandpack>
<pre><code class="language-js">import { useState } from 'react';
import { initialTravelPlan } from './places.js';

function PlaceTree({ place }) {
  const childPlaces = place.childPlaces;
  return (
    &lt;li&gt;
      {place.title}
      {childPlaces.length &gt; 0 &amp;&amp; (
        &lt;ol&gt;
          {childPlaces.map(place =&gt; (
            &lt;PlaceTree key={place.id} place={place} /&gt;
          ))}
        &lt;/ol&gt;
      )}
    &lt;/li&gt;
  );
}

export default function TravelPlan() {
  const [plan, setPlan] = useState(initialTravelPlan);
  const planets = plan.childPlaces;
  return (
    &lt;&gt;
      &lt;h2&gt;Places to visit&lt;/h2&gt;
      &lt;ol&gt;
        {planets.map(place =&gt; (
          &lt;PlaceTree key={place.id} place={place} /&gt;
        ))}
      &lt;/ol&gt;
    &lt;/&gt;
  );
}
</code></pre>
<pre><code class="language-js places.js active">export const initialTravelPlan = {
  id: 0,
  title: '(Root)',
  childPlaces: [{
    id: 1,
    title: 'Earth',
    childPlaces: [{
      id: 2,
      title: 'Africa',
      childPlaces: [{
        id: 3,
        title: 'Botswana',
        childPlaces: []
      }, {
        id: 4,
        title: 'Egypt',
        childPlaces: []
      }, {
        id: 5,
        title: 'Kenya',
        childPlaces: []
      }, {
        id: 6,
        title: 'Madagascar',
        childPlaces: []
      }, {
        id: 7,
        title: 'Morocco',
        childPlaces: []
      }, {
        id: 8,
        title: 'Nigeria',
        childPlaces: []
      }, {
        id: 9,
        title: 'South Africa',
        childPlaces: []
      }]
    }, {
      id: 10,
      title: 'Americas',
      childPlaces: [{
        id: 11,
        title: 'Argentina',
        childPlaces: []
      }, {
        id: 12,
        title: 'Brazil',
        childPlaces: []
      }, {
        id: 13,
        title: 'Barbados',
        childPlaces: []
      }, {
        id: 14,
        title: 'Canada',
        childPlaces: []
      }, {
        id: 15,
        title: 'Jamaica',
        childPlaces: []
      }, {
        id: 16,
        title: 'Mexico',
        childPlaces: []
      }, {
        id: 17,
        title: 'Trinidad and Tobago',
        childPlaces: []
      }, {
        id: 18,
        title: 'Venezuela',
        childPlaces: []
      }]
    }, {
      id: 19,
      title: 'Asia',
      childPlaces: [{
        id: 20,
        title: 'China',
        childPlaces: []
      }, {
        id: 21,
        title: 'Hong Kong',
        childPlaces: []
      }, {
        id: 22,
        title: 'India',
        childPlaces: []
      }, {
        id: 23,
        title: 'Singapore',
        childPlaces: []
      }, {
        id: 24,
        title: 'South Korea',
        childPlaces: []
      }, {
        id: 25,
        title: 'Thailand',
        childPlaces: []
      }, {
        id: 26,
        title: 'Vietnam',
        childPlaces: []
      }]
    }, {
      id: 27,
      title: 'Europe',
      childPlaces: [{
        id: 28,
        title: 'Croatia',
        childPlaces: [],
      }, {
        id: 29,
        title: 'France',
        childPlaces: [],
      }, {
        id: 30,
        title: 'Germany',
        childPlaces: [],
      }, {
        id: 31,
        title: 'Italy',
        childPlaces: [],
      }, {
        id: 32,
        title: 'Portugal',
        childPlaces: [],
      }, {
        id: 33,
        title: 'Spain',
        childPlaces: [],
      }, {
        id: 34,
        title: 'Turkey',
        childPlaces: [],
      }]
    }, {
      id: 35,
      title: 'Oceania',
      childPlaces: [{
        id: 36,
        title: 'Australia',
        childPlaces: [],
      }, {
        id: 37,
        title: 'Bora Bora (French Polynesia)',
        childPlaces: [],
      }, {
        id: 38,
        title: 'Easter Island (Chile)',
        childPlaces: [],
      }, {
        id: 39,
        title: 'Fiji',
        childPlaces: [],
      }, {
        id: 40,
        title: 'Hawaii (the USA)',
        childPlaces: [],
      }, {
        id: 41,
        title: 'New Zealand',
        childPlaces: [],
      }, {
        id: 42,
        title: 'Vanuatu',
        childPlaces: [],
      }]
    }]
  }, {
    id: 43,
    title: 'Moon',
    childPlaces: [{
      id: 44,
      title: 'Rheita',
      childPlaces: []
    }, {
      id: 45,
      title: 'Piccolomini',
      childPlaces: []
    }, {
      id: 46,
      title: 'Tycho',
      childPlaces: []
    }]
  }, {
    id: 47,
    title: 'Mars',
    childPlaces: [{
      id: 48,
      title: 'Corn Town',
      childPlaces: []
    }, {
      id: 49,
      title: 'Green Hill',
      childPlaces: []      
    }]
  }]
};
</code></pre>
</Sandpack>
<p>Now let's say you want to add a button to delete a place you've already visited. How would you go about it? <a href="/learn/updating-objects-in-state#updating-a-nested-object">Updating nested state</a> involves making copies of objects all the way up from the part that changed. Deleting a deeply nested place would involve copying its entire parent place chain. Such code can be very verbose.</p>
<p><strong>If the state is too nested to update easily, consider making it &quot;flat&quot;.</strong> Here is one way you can restructure this data. Instead of a tree-like structure where each <code>place</code> has an array of <em>its child places</em>, you can have each place hold an array of <em>its child place IDs</em>. Then you can store a mapping from each place ID to the corresponding place.</p>
<p>This data restructuring might remind you of seeing a database table:</p>
<Sandpack>
<pre><code class="language-js">import { useState } from 'react';
import { initialTravelPlan } from './places.js';

function PlaceTree({ id, placesById }) {
  const place = placesById[id];
  const childIds = place.childIds;
  return (
    &lt;li&gt;
      {place.title}
      {childIds.length &gt; 0 &amp;&amp; (
        &lt;ol&gt;
          {childIds.map(childId =&gt; (
            &lt;PlaceTree
              key={childId}
              id={childId}
              placesById={placesById}
            /&gt;
          ))}
        &lt;/ol&gt;
      )}
    &lt;/li&gt;
  );
}

export default function TravelPlan() {
  const [plan, setPlan] = useState(initialTravelPlan);
  const root = plan[0];
  const planetIds = root.childIds;
  return (
    &lt;&gt;
      &lt;h2&gt;Places to visit&lt;/h2&gt;
      &lt;ol&gt;
        {planetIds.map(id =&gt; (
          &lt;PlaceTree
            key={id}
            id={id}
            placesById={plan}
          /&gt;
        ))}
      &lt;/ol&gt;
    &lt;/&gt;
  );
}
</code></pre>
<pre><code class="language-js places.js active">export const initialTravelPlan = {
  0: {
    id: 0,
    title: '(Root)',
    childIds: [1, 43, 47],
  },
  1: {
    id: 1,
    title: 'Earth',
    childIds: [2, 10, 19, 27, 35]
  },
  2: {
    id: 2,
    title: 'Africa',
    childIds: [3, 4, 5, 6 , 7, 8, 9]
  }, 
  3: {
    id: 3,
    title: 'Botswana',
    childIds: []
  },
  4: {
    id: 4,
    title: 'Egypt',
    childIds: []
  },
  5: {
    id: 5,
    title: 'Kenya',
    childIds: []
  },
  6: {
    id: 6,
    title: 'Madagascar',
    childIds: []
  }, 
  7: {
    id: 7,
    title: 'Morocco',
    childIds: []
  },
  8: {
    id: 8,
    title: 'Nigeria',
    childIds: []
  },
  9: {
    id: 9,
    title: 'South Africa',
    childIds: []
  },
  10: {
    id: 10,
    title: 'Americas',
    childIds: [11, 12, 13, 14, 15, 16, 17, 18],   
  },
  11: {
    id: 11,
    title: 'Argentina',
    childIds: []
  },
  12: {
    id: 12,
    title: 'Brazil',
    childIds: []
  },
  13: {
    id: 13,
    title: 'Barbados',
    childIds: []
  }, 
  14: {
    id: 14,
    title: 'Canada',
    childIds: []
  },
  15: {
    id: 15,
    title: 'Jamaica',
    childIds: []
  },
  16: {
    id: 16,
    title: 'Mexico',
    childIds: []
  },
  17: {
    id: 17,
    title: 'Trinidad and Tobago',
    childIds: []
  },
  18: {
    id: 18,
    title: 'Venezuela',
    childIds: []
  },
  19: {
    id: 19,
    title: 'Asia',
    childIds: [20, 21, 22, 23, 24, 25, 26],   
  },
  20: {
    id: 20,
    title: 'China',
    childIds: []
  },
  21: {
    id: 21,
    title: 'Hong Kong',
    childIds: []
  },
  22: {
    id: 22,
    title: 'India',
    childIds: []
  },
  23: {
    id: 23,
    title: 'Singapore',
    childIds: []
  },
  24: {
    id: 24,
    title: 'South Korea',
    childIds: []
  },
  25: {
    id: 25,
    title: 'Thailand',
    childIds: []
  },
  26: {
    id: 26,
    title: 'Vietnam',
    childIds: []
  },
  27: {
    id: 27,
    title: 'Europe',
    childIds: [28, 29, 30, 31, 32, 33, 34],   
  },
  28: {
    id: 28,
    title: 'Croatia',
    childIds: []
  },
  29: {
    id: 29,
    title: 'France',
    childIds: []
  },
  30: {
    id: 30,
    title: 'Germany',
    childIds: []
  },
  31: {
    id: 31,
    title: 'Italy',
    childIds: []
  },
  32: {
    id: 32,
    title: 'Portugal',
    childIds: []
  },
  33: {
    id: 33,
    title: 'Spain',
    childIds: []
  },
  34: {
    id: 34,
    title: 'Turkey',
    childIds: []
  },
  35: {
    id: 35,
    title: 'Oceania',
    childIds: [36, 37, 38, 39, 40, 41, 42],   
  },
  36: {
    id: 36,
    title: 'Australia',
    childIds: []
  },
  37: {
    id: 37,
    title: 'Bora Bora (French Polynesia)',
    childIds: []
  },
  38: {
    id: 38,
    title: 'Easter Island (Chile)',
    childIds: []
  },
  39: {
    id: 39,
    title: 'Fiji',
    childIds: []
  },
  40: {
    id: 40,
    title: 'Hawaii (the USA)',
    childIds: []
  },
  41: {
    id: 41,
    title: 'New Zealand',
    childIds: []
  },
  42: {
    id: 42,
    title: 'Vanuatu',
    childIds: []
  },
  43: {
    id: 43,
    title: 'Moon',
    childIds: [44, 45, 46]
  },
  44: {
    id: 44,
    title: 'Rheita',
    childIds: []
  },
  45: {
    id: 45,
    title: 'Piccolomini',
    childIds: []
  },
  46: {
    id: 46,
    title: 'Tycho',
    childIds: []
  },
  47: {
    id: 47,
    title: 'Mars',
    childIds: [48, 49]
  },
  48: {
    id: 48,
    title: 'Corn Town',
    childIds: []
  },
  49: {
    id: 49,
    title: 'Green Hill',
    childIds: []
  }
};
</code></pre>
</Sandpack>
<p><strong>Now that the state is &quot;flat&quot; (also known as &quot;normalized&quot;), updating nested items becomes easier.</strong></p>
<p>In order to remove a place now, you only need to update two levels of state:</p>
<ul>
<li>The updated version of its <em>parent</em> place should exclude the removed ID from its <code>childIds</code> array.</li>
<li>The updated version of the root &quot;table&quot; object should include the updated version of the parent place.</li>
</ul>
<p>Here is an example of how you could go about it:</p>
<Sandpack>
<pre><code class="language-js">import { useState } from 'react';
import { initialTravelPlan } from './places.js';

export default function TravelPlan() {
  const [plan, setPlan] = useState(initialTravelPlan);

  function handleComplete(parentId, childId) {
    const parent = plan[parentId];
    // Create a new version of the parent place
    // that doesn't include this child ID.
    const nextParent = {
      ...parent,
      childIds: parent.childIds
        .filter(id =&gt; id !== childId)
    };
    // Update the root state object...
    setPlan({
      ...plan,
      // ...so that it has the updated parent.
      [parentId]: nextParent
    });
  }

  const root = plan[0];
  const planetIds = root.childIds;
  return (
    &lt;&gt;
      &lt;h2&gt;Places to visit&lt;/h2&gt;
      &lt;ol&gt;
        {planetIds.map(id =&gt; (
          &lt;PlaceTree
            key={id}
            id={id}
            parentId={0}
            placesById={plan}
            onComplete={handleComplete}
          /&gt;
        ))}
      &lt;/ol&gt;
    &lt;/&gt;
  );
}

function PlaceTree({ id, parentId, placesById, onComplete }) {
  const place = placesById[id];
  const childIds = place.childIds;
  return (
    &lt;li&gt;
      {place.title}
      &lt;button onClick={() =&gt; {
        onComplete(parentId, id);
      }}&gt;
        Complete
      &lt;/button&gt;
      {childIds.length &gt; 0 &amp;&amp;
        &lt;ol&gt;
          {childIds.map(childId =&gt; (
            &lt;PlaceTree
              key={childId}
              id={childId}
              parentId={id}
              placesById={placesById}
              onComplete={onComplete}
            /&gt;
          ))}
        &lt;/ol&gt;
      }
    &lt;/li&gt;
  );
}
</code></pre>
<pre><code class="language-js places.js">export const initialTravelPlan = {
  0: {
    id: 0,
    title: '(Root)',
    childIds: [1, 43, 47],
  },
  1: {
    id: 1,
    title: 'Earth',
    childIds: [2, 10, 19, 27, 35]
  },
  2: {
    id: 2,
    title: 'Africa',
    childIds: [3, 4, 5, 6 , 7, 8, 9]
  }, 
  3: {
    id: 3,
    title: 'Botswana',
    childIds: []
  },
  4: {
    id: 4,
    title: 'Egypt',
    childIds: []
  },
  5: {
    id: 5,
    title: 'Kenya',
    childIds: []
  },
  6: {
    id: 6,
    title: 'Madagascar',
    childIds: []
  }, 
  7: {
    id: 7,
    title: 'Morocco',
    childIds: []
  },
  8: {
    id: 8,
    title: 'Nigeria',
    childIds: []
  },
  9: {
    id: 9,
    title: 'South Africa',
    childIds: []
  },
  10: {
    id: 10,
    title: 'Americas',
    childIds: [11, 12, 13, 14, 15, 16, 17, 18],   
  },
  11: {
    id: 11,
    title: 'Argentina',
    childIds: []
  },
  12: {
    id: 12,
    title: 'Brazil',
    childIds: []
  },
  13: {
    id: 13,
    title: 'Barbados',
    childIds: []
  }, 
  14: {
    id: 14,
    title: 'Canada',
    childIds: []
  },
  15: {
    id: 15,
    title: 'Jamaica',
    childIds: []
  },
  16: {
    id: 16,
    title: 'Mexico',
    childIds: []
  },
  17: {
    id: 17,
    title: 'Trinidad and Tobago',
    childIds: []
  },
  18: {
    id: 18,
    title: 'Venezuela',
    childIds: []
  },
  19: {
    id: 19,
    title: 'Asia',
    childIds: [20, 21, 22, 23, 24, 25, 26],   
  },
  20: {
    id: 20,
    title: 'China',
    childIds: []
  },
  21: {
    id: 21,
    title: 'Hong Kong',
    childIds: []
  },
  22: {
    id: 22,
    title: 'India',
    childIds: []
  },
  23: {
    id: 23,
    title: 'Singapore',
    childIds: []
  },
  24: {
    id: 24,
    title: 'South Korea',
    childIds: []
  },
  25: {
    id: 25,
    title: 'Thailand',
    childIds: []
  },
  26: {
    id: 26,
    title: 'Vietnam',
    childIds: []
  },
  27: {
    id: 27,
    title: 'Europe',
    childIds: [28, 29, 30, 31, 32, 33, 34],   
  },
  28: {
    id: 28,
    title: 'Croatia',
    childIds: []
  },
  29: {
    id: 29,
    title: 'France',
    childIds: []
  },
  30: {
    id: 30,
    title: 'Germany',
    childIds: []
  },
  31: {
    id: 31,
    title: 'Italy',
    childIds: []
  },
  32: {
    id: 32,
    title: 'Portugal',
    childIds: []
  },
  33: {
    id: 33,
    title: 'Spain',
    childIds: []
  },
  34: {
    id: 34,
    title: 'Turkey',
    childIds: []
  },
  35: {
    id: 35,
    title: 'Oceania',
    childIds: [36, 37, 38, 39, 40, 41,, 42],   
  },
  36: {
    id: 36,
    title: 'Australia',
    childIds: []
  },
  37: {
    id: 37,
    title: 'Bora Bora (French Polynesia)',
    childIds: []
  },
  38: {
    id: 38,
    title: 'Easter Island (Chile)',
    childIds: []
  },
  39: {
    id: 39,
    title: 'Fiji',
    childIds: []
  },
  40: {
    id: 40,
    title: 'Hawaii (the USA)',
    childIds: []
  },
  41: {
    id: 41,
    title: 'New Zealand',
    childIds: []
  },
  42: {
    id: 42,
    title: 'Vanuatu',
    childIds: []
  },
  43: {
    id: 43,
    title: 'Moon',
    childIds: [44, 45, 46]
  },
  44: {
    id: 44,
    title: 'Rheita',
    childIds: []
  },
  45: {
    id: 45,
    title: 'Piccolomini',
    childIds: []
  },
  46: {
    id: 46,
    title: 'Tycho',
    childIds: []
  },
  47: {
    id: 47,
    title: 'Mars',
    childIds: [48, 49]
  },
  48: {
    id: 48,
    title: 'Corn Town',
    childIds: []
  },
  49: {
    id: 49,
    title: 'Green Hill',
    childIds: []
  }
};
</code></pre>
<pre><code class="language-css">button { margin: 10px; }
</code></pre>
</Sandpack>
<p>You can nest state as much as you like, but making it &quot;flat&quot; can solve numerous problems. It makes state easier to update, and it helps ensure you don't have duplication in different parts of a nested object.</p>
<DeepDive>
<h4 id="improving-memory-usage-improving-memory-usage"><a class="header" href="#improving-memory-usage-improving-memory-usage">Improving memory usage {/<em>improving-memory-usage</em>/}</a></h4>
<p>Ideally, you would also remove the deleted items (and their children!) from the &quot;table&quot; object to improve memory usage. This version does that. It also <a href="/learn/updating-objects-in-state#write-concise-update-logic-with-immer">uses Immer</a> to make the update logic more concise.</p>
<Sandpack>
<pre><code class="language-js">import { useImmer } from 'use-immer';
import { initialTravelPlan } from './places.js';

export default function TravelPlan() {
  const [plan, updatePlan] = useImmer(initialTravelPlan);

  function handleComplete(parentId, childId) {
    updatePlan(draft =&gt; {
      // Remove from the parent place's child IDs.
      const parent = draft[parentId];
      parent.childIds = parent.childIds
        .filter(id =&gt; id !== childId);

      // Forget this place and all its subtree.
      deleteAllChildren(childId);
      function deleteAllChildren(id) {
        const place = draft[id];
        place.childIds.forEach(deleteAllChildren);
        delete draft[id];
      }
    });
  }

  const root = plan[0];
  const planetIds = root.childIds;
  return (
    &lt;&gt;
      &lt;h2&gt;Places to visit&lt;/h2&gt;
      &lt;ol&gt;
        {planetIds.map(id =&gt; (
          &lt;PlaceTree
            key={id}
            id={id}
            parentId={0}
            placesById={plan}
            onComplete={handleComplete}
          /&gt;
        ))}
      &lt;/ol&gt;
    &lt;/&gt;
  );
}

function PlaceTree({ id, parentId, placesById, onComplete }) {
  const place = placesById[id];
  const childIds = place.childIds;
  return (
    &lt;li&gt;
      {place.title}
      &lt;button onClick={() =&gt; {
        onComplete(parentId, id);
      }}&gt;
        Complete
      &lt;/button&gt;
      {childIds.length &gt; 0 &amp;&amp;
        &lt;ol&gt;
          {childIds.map(childId =&gt; (
            &lt;PlaceTree
              key={childId}
              id={childId}
              parentId={id}
              placesById={placesById}
              onComplete={onComplete}
            /&gt;
          ))}
        &lt;/ol&gt;
      }
    &lt;/li&gt;
  );
}
</code></pre>
<pre><code class="language-js places.js">export const initialTravelPlan = {
  0: {
    id: 0,
    title: '(Root)',
    childIds: [1, 43, 47],
  },
  1: {
    id: 1,
    title: 'Earth',
    childIds: [2, 10, 19, 27, 35]
  },
  2: {
    id: 2,
    title: 'Africa',
    childIds: [3, 4, 5, 6 , 7, 8, 9]
  }, 
  3: {
    id: 3,
    title: 'Botswana',
    childIds: []
  },
  4: {
    id: 4,
    title: 'Egypt',
    childIds: []
  },
  5: {
    id: 5,
    title: 'Kenya',
    childIds: []
  },
  6: {
    id: 6,
    title: 'Madagascar',
    childIds: []
  }, 
  7: {
    id: 7,
    title: 'Morocco',
    childIds: []
  },
  8: {
    id: 8,
    title: 'Nigeria',
    childIds: []
  },
  9: {
    id: 9,
    title: 'South Africa',
    childIds: []
  },
  10: {
    id: 10,
    title: 'Americas',
    childIds: [11, 12, 13, 14, 15, 16, 17, 18],   
  },
  11: {
    id: 11,
    title: 'Argentina',
    childIds: []
  },
  12: {
    id: 12,
    title: 'Brazil',
    childIds: []
  },
  13: {
    id: 13,
    title: 'Barbados',
    childIds: []
  }, 
  14: {
    id: 14,
    title: 'Canada',
    childIds: []
  },
  15: {
    id: 15,
    title: 'Jamaica',
    childIds: []
  },
  16: {
    id: 16,
    title: 'Mexico',
    childIds: []
  },
  17: {
    id: 17,
    title: 'Trinidad and Tobago',
    childIds: []
  },
  18: {
    id: 18,
    title: 'Venezuela',
    childIds: []
  },
  19: {
    id: 19,
    title: 'Asia',
    childIds: [20, 21, 22, 23, 24, 25, 26],   
  },
  20: {
    id: 20,
    title: 'China',
    childIds: []
  },
  21: {
    id: 21,
    title: 'Hong Kong',
    childIds: []
  },
  22: {
    id: 22,
    title: 'India',
    childIds: []
  },
  23: {
    id: 23,
    title: 'Singapore',
    childIds: []
  },
  24: {
    id: 24,
    title: 'South Korea',
    childIds: []
  },
  25: {
    id: 25,
    title: 'Thailand',
    childIds: []
  },
  26: {
    id: 26,
    title: 'Vietnam',
    childIds: []
  },
  27: {
    id: 27,
    title: 'Europe',
    childIds: [28, 29, 30, 31, 32, 33, 34],   
  },
  28: {
    id: 28,
    title: 'Croatia',
    childIds: []
  },
  29: {
    id: 29,
    title: 'France',
    childIds: []
  },
  30: {
    id: 30,
    title: 'Germany',
    childIds: []
  },
  31: {
    id: 31,
    title: 'Italy',
    childIds: []
  },
  32: {
    id: 32,
    title: 'Portugal',
    childIds: []
  },
  33: {
    id: 33,
    title: 'Spain',
    childIds: []
  },
  34: {
    id: 34,
    title: 'Turkey',
    childIds: []
  },
  35: {
    id: 35,
    title: 'Oceania',
    childIds: [36, 37, 38, 39, 40, 41,, 42],   
  },
  36: {
    id: 36,
    title: 'Australia',
    childIds: []
  },
  37: {
    id: 37,
    title: 'Bora Bora (French Polynesia)',
    childIds: []
  },
  38: {
    id: 38,
    title: 'Easter Island (Chile)',
    childIds: []
  },
  39: {
    id: 39,
    title: 'Fiji',
    childIds: []
  },
  40: {
    id: 40,
    title: 'Hawaii (the USA)',
    childIds: []
  },
  41: {
    id: 41,
    title: 'New Zealand',
    childIds: []
  },
  42: {
    id: 42,
    title: 'Vanuatu',
    childIds: []
  },
  43: {
    id: 43,
    title: 'Moon',
    childIds: [44, 45, 46]
  },
  44: {
    id: 44,
    title: 'Rheita',
    childIds: []
  },
  45: {
    id: 45,
    title: 'Piccolomini',
    childIds: []
  },
  46: {
    id: 46,
    title: 'Tycho',
    childIds: []
  },
  47: {
    id: 47,
    title: 'Mars',
    childIds: [48, 49]
  },
  48: {
    id: 48,
    title: 'Corn Town',
    childIds: []
  },
  49: {
    id: 49,
    title: 'Green Hill',
    childIds: []
  }
};
</code></pre>
<pre><code class="language-css">button { margin: 10px; }
</code></pre>
<pre><code class="language-json package.json">{
  &quot;dependencies&quot;: {
    &quot;immer&quot;: &quot;1.7.3&quot;,
    &quot;react&quot;: &quot;latest&quot;,
    &quot;react-dom&quot;: &quot;latest&quot;,
    &quot;react-scripts&quot;: &quot;latest&quot;,
    &quot;use-immer&quot;: &quot;0.5.1&quot;
  },
  &quot;scripts&quot;: {
    &quot;start&quot;: &quot;react-scripts start&quot;,
    &quot;build&quot;: &quot;react-scripts build&quot;,
    &quot;test&quot;: &quot;react-scripts test --env=jsdom&quot;,
    &quot;eject&quot;: &quot;react-scripts eject&quot;
  }
}
</code></pre>
</Sandpack>
</DeepDive>
<p>Sometimes, you can also reduce state nesting by moving some of the nested state into the child components. This works well for ephemeral UI state that doesn't need to be stored, like whether an item is hovered.</p>
<Recap>
<ul>
<li>If two state variables always update together, consider merging them into one. </li>
<li>Choose your state variables carefully to avoid creating &quot;impossible&quot; states.</li>
<li>Structure your state in a way that reduces the chances that you'll make a mistake updating it.</li>
<li>Avoid redundant and duplicate state so that you don't need to keep it in sync.</li>
<li>Don't put props <em>into</em> state unless you specifically want to prevent updates.</li>
<li>For UI patterns like selection, keep ID or index in state instead of the object itself.</li>
<li>If updating deeply nested state is complicated, try flattening it.</li>
</ul>
</Recap>
<Challenges>
<h4 id="fix-a-component-thats-not-updating-fix-a-component-thats-not-updating"><a class="header" href="#fix-a-component-thats-not-updating-fix-a-component-thats-not-updating">Fix a component that's not updating {/<em>fix-a-component-thats-not-updating</em>/}</a></h4>
<p>This <code>Clock</code> component receives two props: <code>color</code> and <code>time</code>. When you select a different color in the select box, the <code>Clock</code> component receives a different <code>color</code> prop from its parent component. However, for some reason, the displayed color doesn't update. Why? Fix the problem.</p>
<Sandpack>
<pre><code class="language-js Clock.js active">import { useState } from 'react';

export default function Clock(props) {
  const [color, setColor] = useState(props.color);
  return (
    &lt;h1 style={{ color: color }}&gt;
      {props.time}
    &lt;/h1&gt;
  );
}
</code></pre>
<pre><code class="language-js App.js hidden">import { useState, useEffect } from 'react';
import Clock from './Clock.js';

function useTime() {
  const [time, setTime] = useState(() =&gt; new Date());
  useEffect(() =&gt; {
    const id = setInterval(() =&gt; {
      setTime(new Date());
    }, 1000);
    return () =&gt; clearInterval(id);
  }, []);
  return time;
}

export default function App() {
  const time = useTime();
  const [color, setColor] = useState('lightcoral');
  return (
    &lt;div&gt;
      &lt;p&gt;
        Pick a color:{' '}
        &lt;select value={color} onChange={e =&gt; setColor(e.target.value)}&gt;
          &lt;option value=&quot;lightcoral&quot;&gt;lightcoral&lt;/option&gt;
          &lt;option value=&quot;midnightblue&quot;&gt;midnightblue&lt;/option&gt;
          &lt;option value=&quot;rebeccapurple&quot;&gt;rebeccapurple&lt;/option&gt;
        &lt;/select&gt;
      &lt;/p&gt;
      &lt;Clock color={color} time={time.toLocaleTimeString()} /&gt;
    &lt;/div&gt;
  );
}
</code></pre>
</Sandpack>
<Solution>
<p>The issue is that this component has <code>color</code> state initialized with the initial value of the <code>color</code> prop. But when the <code>color</code> prop changes, this does not affect the state variable! So they get out of sync. To fix this issue, remove the state variable altogether, and use the <code>color</code> prop directly.</p>
<Sandpack>
<pre><code class="language-js Clock.js active">import { useState } from 'react';

export default function Clock(props) {
  return (
    &lt;h1 style={{ color: props.color }}&gt;
      {props.time}
    &lt;/h1&gt;
  );
}
</code></pre>
<pre><code class="language-js App.js hidden">import { useState, useEffect } from 'react';
import Clock from './Clock.js';

function useTime() {
  const [time, setTime] = useState(() =&gt; new Date());
  useEffect(() =&gt; {
    const id = setInterval(() =&gt; {
      setTime(new Date());
    }, 1000);
    return () =&gt; clearInterval(id);
  }, []);
  return time;
}

export default function App() {
  const time = useTime();
  const [color, setColor] = useState('lightcoral');
  return (
    &lt;div&gt;
      &lt;p&gt;
        Pick a color:{' '}
        &lt;select value={color} onChange={e =&gt; setColor(e.target.value)}&gt;
          &lt;option value=&quot;lightcoral&quot;&gt;lightcoral&lt;/option&gt;
          &lt;option value=&quot;midnightblue&quot;&gt;midnightblue&lt;/option&gt;
          &lt;option value=&quot;rebeccapurple&quot;&gt;rebeccapurple&lt;/option&gt;
        &lt;/select&gt;
      &lt;/p&gt;
      &lt;Clock color={color} time={time.toLocaleTimeString()} /&gt;
    &lt;/div&gt;
  );
}
</code></pre>
</Sandpack>
<p>Or, using the destructuring syntax:</p>
<Sandpack>
<pre><code class="language-js Clock.js active">import { useState } from 'react';

export default function Clock({ color, time }) {
  return (
    &lt;h1 style={{ color: color }}&gt;
      {time}
    &lt;/h1&gt;
  );
}
</code></pre>
<pre><code class="language-js App.js hidden">import { useState, useEffect } from 'react';
import Clock from './Clock.js';

function useTime() {
  const [time, setTime] = useState(() =&gt; new Date());
  useEffect(() =&gt; {
    const id = setInterval(() =&gt; {
      setTime(new Date());
    }, 1000);
    return () =&gt; clearInterval(id);
  }, []);
  return time;
}

export default function App() {
  const time = useTime();
  const [color, setColor] = useState('lightcoral');
  return (
    &lt;div&gt;
      &lt;p&gt;
        Pick a color:{' '}
        &lt;select value={color} onChange={e =&gt; setColor(e.target.value)}&gt;
          &lt;option value=&quot;lightcoral&quot;&gt;lightcoral&lt;/option&gt;
          &lt;option value=&quot;midnightblue&quot;&gt;midnightblue&lt;/option&gt;
          &lt;option value=&quot;rebeccapurple&quot;&gt;rebeccapurple&lt;/option&gt;
        &lt;/select&gt;
      &lt;/p&gt;
      &lt;Clock color={color} time={time.toLocaleTimeString()} /&gt;
    &lt;/div&gt;
  );
}
</code></pre>
</Sandpack>
</Solution>
<h4 id="fix-a-broken-packing-list-fix-a-broken-packing-list"><a class="header" href="#fix-a-broken-packing-list-fix-a-broken-packing-list">Fix a broken packing list {/<em>fix-a-broken-packing-list</em>/}</a></h4>
<p>This packing list has a footer that shows how many items are packed, and how many items there are overall. It seems to work at first, but it is buggy. For example, if you mark an item as packed and then delete it, the counter will not be updated correctly. Fix the counter so that it's always correct.</p>
<Hint>
<p>Is any state in this example redundant?</p>
</Hint>
<Sandpack>
<pre><code class="language-js App.js">import { useState } from 'react';
import AddItem from './AddItem.js';
import PackingList from './PackingList.js';

let nextId = 3;
const initialItems = [
  { id: 0, title: 'Warm socks', packed: true },
  { id: 1, title: 'Travel journal', packed: false },
  { id: 2, title: 'Watercolors', packed: false },
];

export default function TravelPlan() {
  const [items, setItems] = useState(initialItems);
  const [total, setTotal] = useState(3);
  const [packed, setPacked] = useState(1);

  function handleAddItem(title) {
    setTotal(total + 1);
    setItems([
      ...items,
      {
        id: nextId++,
        title: title,
        packed: false
      }
    ]);
  }

  function handleChangeItem(nextItem) {
    if (nextItem.packed) {
      setPacked(packed + 1);
    } else {
      setPacked(packed - 1);
    }
    setItems(items.map(item =&gt; {
      if (item.id === nextItem.id) {
        return nextItem;
      } else {
        return item;
      }
    }));
  }

  function handleDeleteItem(itemId) {
    setTotal(total - 1);
    setItems(
      items.filter(item =&gt; item.id !== itemId)
    );
  }

  return (
    &lt;&gt;  
      &lt;AddItem
        onAddItem={handleAddItem}
      /&gt;
      &lt;PackingList
        items={items}
        onChangeItem={handleChangeItem}
        onDeleteItem={handleDeleteItem}
      /&gt;
      &lt;hr /&gt;
      &lt;b&gt;{packed} out of {total} packed!&lt;/b&gt;
    &lt;/&gt;
  );
}
</code></pre>
<pre><code class="language-js AddItem.js hidden">import { useState } from 'react';

export default function AddItem({ onAddItem }) {
  const [title, setTitle] = useState('');
  return (
    &lt;&gt;
      &lt;input
        placeholder=&quot;Add item&quot;
        value={title}
        onChange={e =&gt; setTitle(e.target.value)}
      /&gt;
      &lt;button onClick={() =&gt; {
        setTitle('');
        onAddItem(title);
      }}&gt;Add&lt;/button&gt;
    &lt;/&gt;
  )
}
</code></pre>
<pre><code class="language-js PackingList.js hidden">import { useState } from 'react';

export default function PackingList({
  items,
  onChangeItem,
  onDeleteItem
}) {
  return (
    &lt;ul&gt;
      {items.map(item =&gt; (
        &lt;li key={item.id}&gt;
          &lt;label&gt;
            &lt;input
              type=&quot;checkbox&quot;
              checked={item.packed}
              onChange={e =&gt; {
                onChangeItem({
                  ...item,
                  packed: e.target.checked
                });
              }}
            /&gt;
            {' '}
            {item.title}
          &lt;/label&gt;
          &lt;button onClick={() =&gt; onDeleteItem(item.id)}&gt;
            Delete
          &lt;/button&gt;
        &lt;/li&gt;
      ))}
    &lt;/ul&gt;
  );
}
</code></pre>
<pre><code class="language-css">button { margin: 5px; }
li { list-style-type: none; }
ul, li { margin: 0; padding: 0; }
</code></pre>
</Sandpack>
<Solution>
<p>Although you could carefully change each event handler to update the <code>total</code> and <code>packed</code> counters correctly, the root problem is that these state variables exist at all. They are redundant because you can always calculate the number of items (packed or total) from the <code>items</code> array itself. Remove the redundant state to fix the bug:</p>
<Sandpack>
<pre><code class="language-js App.js">import { useState } from 'react';
import AddItem from './AddItem.js';
import PackingList from './PackingList.js';

let nextId = 3;
const initialItems = [
  { id: 0, title: 'Warm socks', packed: true },
  { id: 1, title: 'Travel journal', packed: false },
  { id: 2, title: 'Watercolors', packed: false },
];

export default function TravelPlan() {
  const [items, setItems] = useState(initialItems);

  const total = items.length;
  const packed = items
    .filter(item =&gt; item.packed)
    .length;

  function handleAddItem(title) {
    setItems([
      ...items,
      {
        id: nextId++,
        title: title,
        packed: false
      }
    ]);
  }

  function handleChangeItem(nextItem) {
    setItems(items.map(item =&gt; {
      if (item.id === nextItem.id) {
        return nextItem;
      } else {
        return item;
      }
    }));
  }

  function handleDeleteItem(itemId) {
    setItems(
      items.filter(item =&gt; item.id !== itemId)
    );
  }

  return (
    &lt;&gt;  
      &lt;AddItem
        onAddItem={handleAddItem}
      /&gt;
      &lt;PackingList
        items={items}
        onChangeItem={handleChangeItem}
        onDeleteItem={handleDeleteItem}
      /&gt;
      &lt;hr /&gt;
      &lt;b&gt;{packed} out of {total} packed!&lt;/b&gt;
    &lt;/&gt;
  );
}
</code></pre>
<pre><code class="language-js AddItem.js hidden">import { useState } from 'react';

export default function AddItem({ onAddItem }) {
  const [title, setTitle] = useState('');
  return (
    &lt;&gt;
      &lt;input
        placeholder=&quot;Add item&quot;
        value={title}
        onChange={e =&gt; setTitle(e.target.value)}
      /&gt;
      &lt;button onClick={() =&gt; {
        setTitle('');
        onAddItem(title);
      }}&gt;Add&lt;/button&gt;
    &lt;/&gt;
  )
}
</code></pre>
<pre><code class="language-js PackingList.js hidden">import { useState } from 'react';

export default function PackingList({
  items,
  onChangeItem,
  onDeleteItem
}) {
  return (
    &lt;ul&gt;
      {items.map(item =&gt; (
        &lt;li key={item.id}&gt;
          &lt;label&gt;
            &lt;input
              type=&quot;checkbox&quot;
              checked={item.packed}
              onChange={e =&gt; {
                onChangeItem({
                  ...item,
                  packed: e.target.checked
                });
              }}
            /&gt;
            {' '}
            {item.title}
          &lt;/label&gt;
          &lt;button onClick={() =&gt; onDeleteItem(item.id)}&gt;
            Delete
          &lt;/button&gt;
        &lt;/li&gt;
      ))}
    &lt;/ul&gt;
  );
}
</code></pre>
<pre><code class="language-css">button { margin: 5px; }
li { list-style-type: none; }
ul, li { margin: 0; padding: 0; }
</code></pre>
</Sandpack>
<p>Notice how the event handlers are only concerned with calling <code>setItems</code> after this change. The item counts are now calculated during the next render from <code>items</code>, so they are always up-to-date.</p>
</Solution>
<h4 id="fix-the-disappearing-selection-fix-the-disappearing-selection"><a class="header" href="#fix-the-disappearing-selection-fix-the-disappearing-selection">Fix the disappearing selection {/<em>fix-the-disappearing-selection</em>/}</a></h4>
<p>There is a list of <code>letters</code> in state. When you hover or focus a particular letter, it gets highlighted. The currently highlighted letter is stored in the <code>highlightedLetter</code> state variable. You can &quot;star&quot; and &quot;unstar&quot; individual letters, which updates the <code>letters</code> array in state.</p>
<p>This code works, but there is a minor UI glitch. When you press &quot;Star&quot; or &quot;Unstar&quot;, the highlighting disappears for a moment. However, it reappears as soon as you move your pointer or switch to another letter with keyboard. Why is this happening? Fix it so that the highlighting doesn't disappear after the button click.</p>
<Sandpack>
<pre><code class="language-js App.js">import { useState } from 'react';
import { initialLetters } from './data.js';
import Letter from './Letter.js';

export default function MailClient() {
  const [letters, setLetters] = useState(initialLetters);
  const [highlightedLetter, setHighlightedLetter] = useState(null);

  function handleHover(letter) {
    setHighlightedLetter(letter);
  }

  function handleStar(starred) {
    setLetters(letters.map(letter =&gt; {
      if (letter.id === starred.id) {
        return {
          ...letter,
          isStarred: !letter.isStarred
        };
      } else {
        return letter;
      }
    }));
  }

  return (
    &lt;&gt;
      &lt;h2&gt;Inbox&lt;/h2&gt;
      &lt;ul&gt;
        {letters.map(letter =&gt; (
          &lt;Letter
            key={letter.id}
            letter={letter}
            isHighlighted={
              letter === highlightedLetter
            }
            onHover={handleHover}
            onToggleStar={handleStar}
          /&gt;
        ))}
      &lt;/ul&gt;
    &lt;/&gt;
  );
}
</code></pre>
<pre><code class="language-js Letter.js">export default function Letter({
  letter,
  isHighlighted,
  onHover,
  onToggleStar,
}) {
  return (
    &lt;li
      className={
        isHighlighted ? 'highlighted' : ''
      }
      onFocus={() =&gt; {
        onHover(letter);        
      }}
      onPointerMove={() =&gt; {
        onHover(letter);
      }}
    &gt;
      &lt;button onClick={() =&gt; {
        onToggleStar(letter);
      }}&gt;
        {letter.isStarred ? 'Unstar' : 'Star'}
      &lt;/button&gt;
      {letter.subject}
    &lt;/li&gt;
  )
}
</code></pre>
<pre><code class="language-js data.js">export const initialLetters = [{
  id: 0,
  subject: 'Ready for adventure?',
  isStarred: true,
}, {
  id: 1,
  subject: 'Time to check in!',
  isStarred: false,
}, {
  id: 2,
  subject: 'Festival Begins in Just SEVEN Days!',
  isStarred: false,
}];
</code></pre>
<pre><code class="language-css">button { margin: 5px; }
li { border-radius: 5px; }
.highlighted { background: #d2eaff; }
</code></pre>
</Sandpack>
<Solution>
<p>The problem is that you're holding the letter object in <code>highlightedLetter</code>. But you're also holding the same information in the <code>letters</code> array. So your state has duplication! When you update the <code>letters</code> array after the button click, you create a new letter object which is different from <code>highlightedLetter</code>. This is why <code>highlightedLetter === letter</code> check becomes <code>false</code>, and the highlight disappears. It reappears the next time you call <code>setHighlightedLetter</code> when the pointer moves.</p>
<p>To fix the issue, remove the duplication from state. Instead of storing <em>the letter itself</em> in two places, store the <code>highlightedId</code> instead. Then you can check <code>isHighlighted</code> for each letter with <code>letter.id === highlightedId</code>, which will work even if the <code>letter</code> object has changed since the last render.</p>
<Sandpack>
<pre><code class="language-js App.js">import { useState } from 'react';
import { initialLetters } from './data.js';
import Letter from './Letter.js';

export default function MailClient() {
  const [letters, setLetters] = useState(initialLetters);
  const [highlightedId, setHighlightedId ] = useState(null);

  function handleHover(letterId) {
    setHighlightedId(letterId);
  }

  function handleStar(starredId) {
    setLetters(letters.map(letter =&gt; {
      if (letter.id === starredId) {
        return {
          ...letter,
          isStarred: !letter.isStarred
        };
      } else {
        return letter;
      }
    }));
  }

  return (
    &lt;&gt;
      &lt;h2&gt;Inbox&lt;/h2&gt;
      &lt;ul&gt;
        {letters.map(letter =&gt; (
          &lt;Letter
            key={letter.id}
            letter={letter}
            isHighlighted={
              letter.id === highlightedId
            }
            onHover={handleHover}
            onToggleStar={handleStar}
          /&gt;
        ))}
      &lt;/ul&gt;
    &lt;/&gt;
  );
}
</code></pre>
<pre><code class="language-js Letter.js">export default function Letter({
  letter,
  isHighlighted,
  onHover,
  onToggleStar,
}) {
  return (
    &lt;li
      className={
        isHighlighted ? 'highlighted' : ''
      }
      onFocus={() =&gt; {
        onHover(letter.id);        
      }}
      onPointerMove={() =&gt; {
        onHover(letter.id);
      }}
    &gt;
      &lt;button onClick={() =&gt; {
        onToggleStar(letter.id);
      }}&gt;
        {letter.isStarred ? 'Unstar' : 'Star'}
      &lt;/button&gt;
      {letter.subject}
    &lt;/li&gt;
  )
}
</code></pre>
<pre><code class="language-js data.js">export const initialLetters = [{
  id: 0,
  subject: 'Ready for adventure?',
  isStarred: true,
}, {
  id: 1,
  subject: 'Time to check in!',
  isStarred: false,
}, {
  id: 2,
  subject: 'Festival Begins in Just SEVEN Days!',
  isStarred: false,
}];
</code></pre>
<pre><code class="language-css">button { margin: 5px; }
li { border-radius: 5px; }
.highlighted { background: #d2eaff; }
</code></pre>
</Sandpack>
</Solution>
<h4 id="implement-multiple-selection-implement-multiple-selection"><a class="header" href="#implement-multiple-selection-implement-multiple-selection">Implement multiple selection {/<em>implement-multiple-selection</em>/}</a></h4>
<p>In this example, each <code>Letter</code> has an <code>isSelected</code> prop and an <code>onToggle</code> handler that marks it as selected. This works, but the state is stored as a <code>selectedId</code> (either <code>null</code> or an ID), so only one letter can get selected at any given time.</p>
<p>Change the state structure to support multiple selection. (How would you structure it? Think about this before writing the code.) Each checkbox should become independent from the others. Clicking a selected letter should uncheck it. Finally, the footer should show the correct number of the selected items.</p>
<Hint>
<p>Instead of a single selected ID, you might want to hold an array or a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set">Set</a> of selected IDs in state.</p>
</Hint>
<Sandpack>
<pre><code class="language-js App.js">import { useState } from 'react';
import { letters } from './data.js';
import Letter from './Letter.js';

export default function MailClient() {
  const [selectedId, setSelectedId] = useState(null);

  // TODO: allow multiple selection
  const selectedCount = 1;

  function handleToggle(toggledId) {
    // TODO: allow multiple selection
    setSelectedId(toggledId);
  }

  return (
    &lt;&gt;
      &lt;h2&gt;Inbox&lt;/h2&gt;
      &lt;ul&gt;
        {letters.map(letter =&gt; (
          &lt;Letter
            key={letter.id}
            letter={letter}
            isSelected={
              // TODO: allow multiple selection
              letter.id === selectedId
            }
            onToggle={handleToggle}
          /&gt;
        ))}
        &lt;hr /&gt;
        &lt;p&gt;
          &lt;b&gt;
            You selected {selectedCount} letters
          &lt;/b&gt;
        &lt;/p&gt;
      &lt;/ul&gt;
    &lt;/&gt;
  );
}
</code></pre>
<pre><code class="language-js Letter.js">export default function Letter({
  letter,
  onToggle,
  isSelected,
}) {
  return (
    &lt;li className={
      isSelected ? 'selected' : ''
    }&gt;
      &lt;label&gt;
        &lt;input
          type=&quot;checkbox&quot;
          checked={isSelected}
          onChange={() =&gt; {
            onToggle(letter.id);
          }}
        /&gt;
        {letter.subject}
      &lt;/label&gt;
    &lt;/li&gt;
  )
}
</code></pre>
<pre><code class="language-js data.js">export const letters = [{
  id: 0,
  subject: 'Ready for adventure?',
  isStarred: true,
}, {
  id: 1,
  subject: 'Time to check in!',
  isStarred: false,
}, {
  id: 2,
  subject: 'Festival Begins in Just SEVEN Days!',
  isStarred: false,
}];
</code></pre>
<pre><code class="language-css">input { margin: 5px; }
li { border-radius: 5px; }
label { width: 100%; padding: 5px; display: inline-block; }
.selected { background: #d2eaff; }
</code></pre>
</Sandpack>
<Solution>
<p>Instead of a single <code>selectedId</code>, keep a <code>selectedIds</code> <em>array</em> in state. For example, if you select the first and the last letter, it would contain <code>[0, 2]</code>. When nothing is selected, it would be an empty <code>[]</code> array:</p>
<Sandpack>
<pre><code class="language-js App.js">import { useState } from 'react';
import { letters } from './data.js';
import Letter from './Letter.js';

export default function MailClient() {
  const [selectedIds, setSelectedIds] = useState([]);

  const selectedCount = selectedIds.length;

  function handleToggle(toggledId) {
    // Was it previously selected?
    if (selectedIds.includes(toggledId)) {
      // Then remove this ID from the array.
      setSelectedIds(selectedIds.filter(id =&gt;
        id !== toggledId
      ));
    } else {
      // Otherwise, add this ID to the array.
      setSelectedIds([
        ...selectedIds,
        toggledId
      ]);
    }
  }

  return (
    &lt;&gt;
      &lt;h2&gt;Inbox&lt;/h2&gt;
      &lt;ul&gt;
        {letters.map(letter =&gt; (
          &lt;Letter
            key={letter.id}
            letter={letter}
            isSelected={
              selectedIds.includes(letter.id)
            }
            onToggle={handleToggle}
          /&gt;
        ))}
        &lt;hr /&gt;
        &lt;p&gt;
          &lt;b&gt;
            You selected {selectedCount} letters
          &lt;/b&gt;
        &lt;/p&gt;
      &lt;/ul&gt;
    &lt;/&gt;
  );
}
</code></pre>
<pre><code class="language-js Letter.js">export default function Letter({
  letter,
  onToggle,
  isSelected,
}) {
  return (
    &lt;li className={
      isSelected ? 'selected' : ''
    }&gt;
      &lt;label&gt;
        &lt;input
          type=&quot;checkbox&quot;
          checked={isSelected}
          onChange={() =&gt; {
            onToggle(letter.id);
          }}
        /&gt;
        {letter.subject}
      &lt;/label&gt;
    &lt;/li&gt;
  )
}
</code></pre>
<pre><code class="language-js data.js">export const letters = [{
  id: 0,
  subject: 'Ready for adventure?',
  isStarred: true,
}, {
  id: 1,
  subject: 'Time to check in!',
  isStarred: false,
}, {
  id: 2,
  subject: 'Festival Begins in Just SEVEN Days!',
  isStarred: false,
}];
</code></pre>
<pre><code class="language-css">input { margin: 5px; }
li { border-radius: 5px; }
label { width: 100%; padding: 5px; display: inline-block; }
.selected { background: #d2eaff; }
</code></pre>
</Sandpack>
<p>One minor downside of using an array is that for each item, you're calling <code>selectedIds.includes(letter.id)</code> to check whether it's selected. If the array is very large, this can become a performance problem because array search with <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/includes"><code>includes()</code></a> takes linear time, and you're doing this search for each individual item.</p>
<p>To fix this, you can hold a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set">Set</a> in state instead, which provides a fast <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set/has"><code>has()</code></a> operation:</p>
<Sandpack>
<pre><code class="language-js App.js">import { useState } from 'react';
import { letters } from './data.js';
import Letter from './Letter.js';

export default function MailClient() {
  const [selectedIds, setSelectedIds] = useState(
    new Set()
  );

  const selectedCount = selectedIds.size;

  function handleToggle(toggledId) {
    // Create a copy (to avoid mutation).
    const nextIds = new Set(selectedIds);
    if (nextIds.has(toggledId)) {
      nextIds.delete(toggledId);
    } else {
      nextIds.add(toggledId);
    }
    setSelectedIds(nextIds);
  }

  return (
    &lt;&gt;
      &lt;h2&gt;Inbox&lt;/h2&gt;
      &lt;ul&gt;
        {letters.map(letter =&gt; (
          &lt;Letter
            key={letter.id}
            letter={letter}
            isSelected={
              selectedIds.has(letter.id)
            }
            onToggle={handleToggle}
          /&gt;
        ))}
        &lt;hr /&gt;
        &lt;p&gt;
          &lt;b&gt;
            You selected {selectedCount} letters
          &lt;/b&gt;
        &lt;/p&gt;
      &lt;/ul&gt;
    &lt;/&gt;
  );
}
</code></pre>
<pre><code class="language-js Letter.js">export default function Letter({
  letter,
  onToggle,
  isSelected,
}) {
  return (
    &lt;li className={
      isSelected ? 'selected' : ''
    }&gt;
      &lt;label&gt;
        &lt;input
          type=&quot;checkbox&quot;
          checked={isSelected}
          onChange={() =&gt; {
            onToggle(letter.id);
          }}
        /&gt;
        {letter.subject}
      &lt;/label&gt;
    &lt;/li&gt;
  )
}
</code></pre>
<pre><code class="language-js data.js">export const letters = [{
  id: 0,
  subject: 'Ready for adventure?',
  isStarred: true,
}, {
  id: 1,
  subject: 'Time to check in!',
  isStarred: false,
}, {
  id: 2,
  subject: 'Festival Begins in Just SEVEN Days!',
  isStarred: false,
}];
</code></pre>
<pre><code class="language-css">input { margin: 5px; }
li { border-radius: 5px; }
label { width: 100%; padding: 5px; display: inline-block; }
.selected { background: #d2eaff; }
</code></pre>
</Sandpack>
<p>Now each item does a <code>selectedIds.has(letter.id)</code> check, which is very fast.</p>
<p>Keep in mind that you <a href="/learn/updating-objects-in-state">should not mutate objects in state</a>, and that includes Sets, too. This is why the <code>handleToggle</code> function creates a <em>copy</em> of the Set first, and then updates that copy.</p>
</Solution>
</Challenges>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../learn/reacting-to-input-with-state.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../learn/sharing-state-between-components.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../learn/reacting-to-input-with-state.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../learn/sharing-state-between-components.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
